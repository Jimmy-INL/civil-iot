<?xml version="1.0" encoding="UTF-8"?>
<ECSchema schemaName="IoTDevices" alias="iot" version="01.00.00" xmlns="http://www.bentley.com/schemas/Bentley.ECXML.3.1" displayLabel="IoT Devices" description="The base classes and relationships for IoT devices.">

  <ECSchemaReference name="BisCore" version="01.00.04" alias="bis"/>

  <ECEntityClass typeName="Sensor">
    <BaseClass>bis:PhysicalElement</BaseClass>
  </ECEntityClass>

  <ECEntityClass typeName="SensorType" displayLabel="Sensor Type">
    <BaseClass>bis:TypeDefinitionElement</BaseClass>
  </ECEntityClass>

  <ECRelationshipClass typeName="SensorIsOfType" strength="referencing" modifier="None">
    <BaseClass>bis:GeometricElement3dHasTypeDefinition</BaseClass>
    <Source multiplicity="(0..*)" roleLabel="is of" polymorphic="true">
      <Class class="Sensor" />
    </Source>
    <Target multiplicity="(0..1)" roleLabel="defines" polymorphic="true">
      <Class class="SensorType"/>
    </Target>
  </ECRelationshipClass>

  <ECRelationshipClass typeName="SensorCoversSpatialElement" strength="referencing" modifier="None" description="Relates a iot:Sensor to a bis:SpatialElement within its coverage area.">
    <BaseClass>bis:ElementRefersToElements</BaseClass>
    <Source multiplicity="(0..*)" roleLabel="covers" polymorphic="true">
      <Class class="Sensor"/>
    </Source>
    <Target multiplicity="(0..*)" roleLabel="is covered by" polymorphic="true">
      <Class class="bis:SpatialElement"/>
    </Target>
  </ECRelationshipClass>

  <ECEntityClass typeName="SensorReadingRecord" displayLabel="Sensor Reading Record" description="Sensor readings are not typically stored in the iModel, but min, max, and expected values might be.">
    <BaseClass>bis:TypeDefinitionElement</BaseClass>
    <ECNavigationProperty propertyName="ReadingType" relationshipName="SensorReadingIsOfType" direction="Forward" displayLabel="Reading Type"/>
    <ECProperty propertyName="ReadingValue" typeName="double"/>
  </ECEntityClass>

  <ECEntityClass typeName="SensorReadingType">
    <BaseClass>bis:TypeDefinitionElement</BaseClass>
    <ECProperty propertyName="ReadingLabel" typeName="string"/>
    <ECProperty propertyName="ReadingUnit" typeName="string"/>
  </ECEntityClass>

  <ECRelationshipClass typeName="SensorReadingIsOfType" strength="referencing" modifier="None">
    <BaseClass>bis:GeometricElement3dHasTypeDefinition</BaseClass>
    <Source multiplicity="(0..*)" roleLabel="is of" polymorphic="true">
      <Class class="SensorReadingRecord" />
    </Source>
    <Target multiplicity="(0..1)" roleLabel="defines" polymorphic="true">
      <Class class="SensorReadingType"/>
    </Target>
  </ECRelationshipClass>

  <ECRelationshipClass typeName="SensorTypeHasReadingTypes" strength="referencing" modifier="None">
    <BaseClass>bis:ElementRefersToElements</BaseClass>
    <Source multiplicity="(0..*)" roleLabel="is of" polymorphic="true">
      <Class class="SensorType" />
    </Source>
    <Target multiplicity="(0..*)" roleLabel="defines" polymorphic="true">
      <Class class="SensorReadingType"/>
    </Target>
  </ECRelationshipClass>

</ECSchema>
